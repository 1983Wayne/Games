import pygame, sys, random
from pygame.locals import *
pygame.init()

PAUSE = False
GREEN = (0, 255, 0)
INVIS = (0, 0, 0, 0)
RUNNING = True
SNOW = True
SQUARE = False
BLACK = (0, 0, 0)
WHITE = (255, 255, 255)
WIDTH = 500
HEIGHT = 400
SIZE = (WIDTH, HEIGHT)
DISPLAYSURF = pygame.display.set_mode(SIZE)
pygame.display.set_caption('GAME')
DONE = False
FPS = 30
CLOCK = pygame.time.Clock()
velocityX = 5
velocityY = 5
SCORE = 0
snowRadius = 2
snowList = []
snowListVelocities = []
snowCount = 30
maxVelocity = 4
minVelocity = 1
snowSize = 1 # looks really decent for simple stars going by
playerImage = pygame.image.load('ship.png')
playerX = ( WIDTH / 2) - 20
playerY = HEIGHT - 50
playerSpeed = 4
bulletSizeX = 4
bulletSizeY = 15
bulletOnScreen = False
bulletLocX = 0
bulletLocY = 0
bulletSpeed = 10
badGuys = []
badGuysSpeed = 2
enemyImg = pygame.image.load('enemy.png')
badGuysDropSpeed = 5
collisionAmt = 8
explosionList = []
expl1 = pygame.image.load('expl1.png')
expl2 = pygame.image.load('expl2.png')
expl3 = pygame.image.load('expl3.png')
expl4 = pygame.image.load('expl4.png')
explosionTimes = []
explosionProgression = 3
badGuyStartHeight = 100
badGuyStartLeft = 20
badGuyRow = 8
badGuyColumn = 5
badGuySpacing = 30
badGuysDirection = 'right'
badPoints = 10 # Amount of points gained per enemy shot down
font = pygame.font.Font('freesansbold.ttf', 25)
font2 = pygame.font.Font('freesansbold.ttf', 20)
pausedFont = pygame.font.Font('freesansbold.ttf', 50)
scorePosnX = WIDTH - 150
scorePosnY = 20
scoreMessage = "SCORE"
scoreAmtPosnX = WIDTH - 120
scoreAmtPosnY = 50
endTimer = 0

def paused():
    global PAUSE
    pausedText = font.render("PRESS G TO CONTINUE", True, WHITE)
    DISPLAYSURF.blit(pausedText, [WIDTH / 4, HEIGHT / 2]) 
    while PAUSE:
        lookForG = pygame.key.get_pressed()
        if lookForG[pygame.K_g]:
            PAUSE = False
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                quit()
        pygame.display.update()
        CLOCK.tick(15)
        

# Start the customizable list off with some baddies.
def createBadGuyList(left, height, spacing):
    for i in range(badGuyRow):
        for j in range(badGuyColumn):
            badGuys.append([i * spacing + left, j * spacing + height])

def quit():
    pygame.quit()
    sys.exit()
    
# Does all the score for the game from here.
def doScore(message, colour, wordScoreX, wordScoreY, amount, amountX, amountY):
    global DISPLAYSURF
    scoreText = font.render(message, True, colour)
    scoreItself = font2.render(str(amount), True, colour)
    DISPLAYSURF.blit(scoreText, [wordScoreX, wordScoreY])
    DISPLAYSURF.blit(scoreItself, [amountX, amountY])
    
# You want a bunch of different speeds of the stars so here it is.
def createSnowSpeeds():
    for i in range(snowCount):
        snowListVelocities.append(random.randint(minVelocity, maxVelocity))

# Should be more called ''randomCoordinates''                            
def randomLocation():
    posnX = random.randint(0, WIDTH)
    posnY = random.randint(0, HEIGHT)
    return [posnX, posnY]
    
# Only called when they hit the edge of the screen, and they'll drop down.
def dropBadGuys(BGlist):
    for i in range(len(BGlist)):
        BGlist[i][1] += badGuysDropSpeed
            
# Super cheesy Explosions!
def animateExplosions(explosionTimes, explosionList):
    for i in range(len(explosionTimes)):
        if explosionTimes[i] < 10:
            DISPLAYSURF.blit(expl1, (explosionList[i][0], explosionList[i][1]))
        elif explosionTimes[i] < 20:
            DISPLAYSURF.blit(expl2, (explosionList[i][0], explosionList[i][1]))
        elif explosionTimes[i] < 30:
            DISPLAYSURF.blit(expl3, (explosionList[i][0], explosionList[i][1]))
        elif explosionTimes[i] < 40:
            DISPLAYSURF.blit(expl4, (explosionList[i][0], explosionList[i][1]))
        elif explosionTimes[i] < 50:
            DISPLAYSURF.blit(expl3, (explosionList[i][0], explosionList[i][1]))
        elif explosionTimes[i] < 60:
            DISPLAYSURF.blit(expl2, (explosionList[i][0], explosionList[i][1]))

def animateStars():
    for i in range(len(snowList)):
        pygame.draw.circle(DISPLAYSURF, WHITE, snowList[i], snowSize)
        snowList[i][1] += snowListVelocities[i]
        #snowListVelocities is one integer per list entry
        if snowList[i][1] > HEIGHT:
            snowList[i] = [random.randint(0, WIDTH), 0]
            
def createSnowList():
    if len(snowList) < 1:
        for i in range(snowCount):
            snowList.append(randomLocation())
    
createSnowList()
createSnowSpeeds()
createBadGuyList(badGuyStartLeft, badGuyStartHeight, badGuySpacing)

while RUNNING:
    DISPLAYSURF.fill(BLACK)
    keys = pygame.key.get_pressed()  
    doScore(scoreMessage, WHITE, scorePosnX, scorePosnY, SCORE, scoreAmtPosnX, scoreAmtPosnY)
    
    if SNOW:
        animateStars()
               
    if keys[pygame.K_LEFT] and playerX >= 10:
        playerX -= playerSpeed
    if keys[pygame.K_RIGHT] and playerX <= WIDTH - 50:
        playerX += playerSpeed
    if keys[pygame.K_SPACE] and not bulletOnScreen:
        bulletOnScreen = True
        bulletLocX = playerX + 18
        bulletLocY = playerY - 10
            
    if bulletOnScreen and bulletLocY >= 0:
        pygame.draw.rect(DISPLAYSURF, WHITE, [bulletLocX, bulletLocY, bulletSizeX, bulletSizeY])
        bulletLocY -= bulletSpeed  
    elif bulletOnScreen and bulletLocY <= 0:
        bulletOnScreen = False
        
    if len(badGuys) > 0:
        if bulletOnScreen:
            for i in range(len(badGuys)):
                if abs(bulletLocX - badGuys[i][0]) <= collisionAmt and abs(bulletLocY - badGuys[i][1]) <= collisionAmt:
                    explosionList.append(badGuys.pop(i))
                    explosionTimes.append(0)
                    bulletOnScreen = False
                    SCORE += badPoints # Score increased per baddy destroyed
                    break    
                
        for i in range(len(badGuys)):
            if badGuys[i][0] < 10:
                badGuysDirection = 'right'
                dropBadGuys(badGuys)   
            elif badGuys[i][0] > WIDTH - 30:
                badGuysDirection = 'left'
                dropBadGuys(badGuys)
                
        for i in range(len(badGuys)):
            if badGuysDirection == 'right':
                badGuys[i][0] += badGuysSpeed
            elif badGuysDirection =='left':
                    badGuys[i][0] -= badGuysSpeed
            DISPLAYSURF.blit(enemyImg, (badGuys[i][0], badGuys[i][1]))
            
    elif len(badGuys) == 0:
        if len (explosionTimes) > 0 and endTimer >= 30:
            explosionTimes = []
            explosionList = []
        endTimer += 1
        
    if len(explosionTimes) > 0:
        for i in range(len(explosionTimes)):
            explosionTimes[i] += explosionProgression #basically a timer
        animateExplosions(explosionTimes, explosionList)
    DISPLAYSURF.blit(playerImage, (playerX, playerY))
            
    for event in pygame.event.get():
        if event.type == QUIT:
            quit()
        if event.type == pygame.KEYUP:
            if event.key == pygame.K_p:
                PAUSE = True
                paused()
                
            
    CLOCK.tick(FPS)
    pygame.display.update()
